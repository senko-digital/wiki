---
title: "Установка MikroTik CHR на виртуальный сервер"
description: "Пошаговое руководство по установке и настройке MikroTik Cloud Hosted Router (CHR) на виртуальном сервере, включая системные требования и настройку сети."
head:
  - - meta
    - name: keywords
      content: mikrotik, chr, routeros, виртуальный сервер, vps, настройка сети, установка роутера, облачный роутер
  - - meta
    - property: og:title
      content: "Установка MikroTik CHR на виртуальный сервер"
  - - meta
    - property: og:description
      content: "Полное руководство по установке и настройке MikroTik Cloud Hosted Router (CHR) на виртуальном сервере, включая системные требования и настройку сети."
---

# Установка MikroTik CHR на виртуальный сервер

<p align="center">
  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="/images/vps/mikrotik-chr/mikrotik-chr-logo.png">
    <img alt="Логотип MikroTik CHR" src="/images/vps/mikrotik-chr/mikrotik-chr-logo.png">
  </picture>
</p>

MikroTik Cloud Hosted Router (CHR) - это специализированная версия RouterOS, оптимизированная для работы в виртуальных машинах и функционирующая как полноценная операционная система.

В этом руководстве мы пошагово рассмотрим процесс установки и настройки MikroTik CHR на вашем виртуальном сервере.

## Системные требования

Вы можете установить MikroTik CHR на любой из наших тарифов виртуальных серверов, включая нашу самую базовую конфигурацию:
- 1 ядро процессора
- 1 ГБ оперативной памяти
- 10 ГБ NVMe хранилища

В данном руководстве мы рассмотрим процесс ручной установки на примере виртуального сервера тарифа i9-PROMO-1.

## Необходимые условия

1. Закажите виртуальный сервер через панель управления или используйте существующий сервер
2. В данном примере мы будем использовать:
   - Тариф: i9-PROMO-1
   - Базовая ОС: Ubuntu 24.04 (необходима для установки CHR)

## Шаги установки

### 1. Настройка сервера
- Ваш сервер будет готов в течение 2 минут после заказа
- Подключитесь к серверу, используя учетные данные SSH, полученные в письме активации или переустановки ОС на сервере
- Инструкции по подключению SSH доступны в нашем руководстве [Как подключиться к серверу (Linux)](/vps/how-to-connect-through-ssh)

### 2. Загрузка образа CHR
- Посетите [официальную страницу загрузки MikroTik](https://mikrotik.com/download)
- Скачайте версию **Raw disk image** CHR (в примере мы используем версию 7.18.2)
![Изображение, показывающее, какую версию MikroTik CHR использовать для виртуального сервера](/images/vps/mikrotik-chr/select-mikrotik-chr-version.png){data-zoomable}
- Щелкните правой кнопкой мыши по иконке загрузки и скопируйте ссылку (например, https://download.mikrotik.com/routeros/7.18.2/chr-7.18.2.img.zip)
- Загрузите образ на ваш виртуальный сервер:
```bash
cd /tmp
wget <ССЫЛКА> -O chr.img.zip
```

Например:
```bash
cd /tmp
wget https://download.mikrotik.com/routeros/7.18.2/chr-7.18.2.img.zip -O chr.img.zip
```

![Изображение, показывающее успешную загрузку образа MikroTik CHR на виртуальный сервер](/images/vps/mikrotik-chr/successful-download-mikrotik-chr.png){data-zoomable}

### 3. Развертывание образа

::: warning
Этот процесс **удалит все данные с вашего сервера**. 
Обязательно **создайте резервную копию важных данных** перед продолжением!
:::

Установите gunzip:
```bash
apt -y install gunzip
```

Распакуйте загруженный образ:
```bash
gunzip -c chr.img.zip > chr.img
```

Переведите файловую систему в режим только для чтения:
```bash
echo u > /proc/sysrq-trigger
```

Запишите образ на виртуальный диск:
```bash
dd if=chr.img of=/dev/vda bs=4M oflag=sync
```

Перезагрузите сервер для инициализации CHR:
```bash
echo 1 > /proc/sys/kernel/sysrq
echo b > /proc/sysrq-trigger
```

После выполнения последней команды и нажатия `[Enter]` ваше SSH-соединение может зависнуть - это вполне нормальное поведение.

Теперь вы можете безопасно отключиться от вашего виртуального сервера. Оставшаяся настройка будет выполняться через веб VNC.

### 4. Настройка сети

Теперь нам нужно получить доступ к панели управления VM для подключения к нашему серверу через VNC.

#### Доступ к системе
- Войдите в [панель управления VM](https://vm.senko.digital/)
- Выберите сервер, на который вы установили MikroTik CHR
- Подключитесь к серверу через VNC-консоль
- Учетные данные по умолчанию:
  - Имя пользователя: admin
  - Пароль: (оставьте пустым)

#### Настройка системы
1. Пропустите лицензионное соглашение (нажмите 'n')
2. Установите новый пароль администратора (рекомендуется не менее 8 символов)
3. Настройте сетевые параметры, используя данные из панели управления:
```bash
/ip address add address=<IPv4>/32 network=<Шлюз> broadcast=<IPv4> interface=ether1
/ip route add dst-address=0.0.0.0/0 gateway=<Шлюз>
/ip dns set servers=1.1.1.1,1.0.0.1
```

Где:
- `<IPv4>` - IP-адрес вашего сервера
- `<Шлюз>` - обычно `172.16.0.1` (для линейки RZ9, EP) или `10.0.0.1` (для линейки i9-PROMO)

Вы можете проверить подключение к интернету, выполнив:
```bash
ping 1.1.1.1
```

При правильной настройке вы должны увидеть ответы от DNS Cloudflare (1.1.1.1):
![Изображение, показывающее правильные настройки MikroTik CHR с тестом ping к DNS Cloudflare](/images/vps/mikrotik-chr/mikrotik-chr-installed.png){data-zoomable}

Ваш MikroTik CHR теперь готов к дальнейшей настройке и использованию. Теперь вы также можете подключаться через SSH.

## Дополнительная настройка

### Создание нового пользователя

Для повышения безопасности рекомендуется создать нового пользователя и удалить пользователя `admin` по умолчанию.

Создайте нового пользователя, выполнив:
```bash
user/add name=имя_пользователя
```

Где `имя_пользователя` - желаемое имя для входа.

Система запросит:
1. Назначить группу - введите `full`
2. Установить пароль - используйте не менее 8 уникальных символов

### Удаление пользователя admin

После создания нового пользователя:
1. Выйдите из текущей сессии:
```bash
/quit
```
2. Войдите с новыми учетными данными через SSH или VNC
3. Удалите пользователя admin:
```bash
user/remove admin
```

### Безопасность сервисов

По умолчанию MikroTik запускает несколько сервисов на различных портах, включая:
- Telnet
- FTP
- HTTP-сервер
- SSH
- API
- Winbox
- SSL API

Эти сервисы могут подвергать ваш сервер рискам безопасности, так как злоумышленники часто пытаются подобрать пароли к роутерам в интернете.

Чтобы проверить текущие запущенные сервисы:
```bash
ip/service/print
```

![Изображение, показывающее сервисы MikroTik CHR, запущенные по умолчанию](/images/vps/mikrotik-chr/mikrotik-chr-default-services.png){data-zoomable}

Отключите неиспользуемые сервисы:
```bash
ip/service/disable n,n,n,n
```

Где `n` - номер сервиса для отключения.

Примеры:
```bash
ip/service/disable 0,1,2,5,7  # Отключает Telnet, FTP, HTTP, API и SSL API
ip/service/disable 3          # Отключает только SSH
ip/service/disable 5,7        # Отключает только API и SSL API
ip/service/disable 1          # Отключает только FTP
```

### Изменение порта SSH

Для дополнительной безопасности измените порт SSH на нестандартный номер (например, 59871):
```bash
set 3 port=ПОРТ
```

Где `ПОРТ` - предпочитаемый номер порта.

Например:
```bash
set 3 port=59871
```

### Информация о лицензии

Проверьте статус лицензии MikroTik CHR:
```bash
/system/license/print
```

CHR предлагает четыре уровня лицензий:
- **free**: скорость 1 Мбит/с (по умолчанию)
- **p1** (perpetual-1): $45, скорость 1 Гбит/с
- **p10** (perpetual-10): $95, скорость 10 Гбит/с
- **p-unlimited** (perpetual-unlimited): $250, неограниченная скорость

Лицензия `free` по умолчанию позволяет неограниченное использование, но ограничивает пропускную способность до 1 Мбит/с на интерфейс.

Для получения дополнительной информации о лицензировании посетите официальную [документацию MikroTik](https://help.mikrotik.com/docs/spaces/ROS/pages/18350234/Cloud+Hosted+Router+CHR).
